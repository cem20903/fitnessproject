{{> menu}}

<h1>PROFILE</h1>

<p></p>
<form method="POST" action="/profile/updateGoal">


<p>Weight: <input type="text" name="weight" id="weight" value={{this.weight}} /> </p>
<p>Goal weight: <input type="text" name="goalWeight" id="goalWeight" value={{this.goalWeight}} /> <button id="updateGoalWeight">Update Goal</button> </p>
<p><input type="hidden" id="dateActualWeight" value={{this.dateActualWeight}}></p>
</form>



<div id="goals"></div>
<div id="calendario"></div>
<script>

const goals = document.getElementById('goals')
let weight = document.getElementById('weight').value
let goalWeight = document.getElementById('goalWeight').value
let restante = weight-goalWeight
let weeks = parseInt((restante*1000)/400) * 7
var date = new Date();

let dateActualWeight = document.getElementById('dateActualWeight').value.split('-')
console.log(dateActualWeight)


goals.innerHTML += "<p>Kilos a perder "+ restante + "</p>" 
goals.innerHTML += "<p>Fecha actual " + date.toISOString().split('T')[0] + "</p>"
date.setDate(date.getDate() + weeks);

date = date.toISOString().split('T')[0]

var goalDay = date.split('-')[2]
var goalMonth = date.split('-')[1]


goals.innerHTML += "<p>Fecha en la que conseguira tu peso " + date + "</p>"

var mes_text = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
var dia_text = ["Dom", "Lun", "Mar", "Mie", "Juv", "Vie", "Sab"];



estructurar();

function estructurar() {

var calendario = document.getElementById('calendario')

  for (m = 0; m <= 11; m++) {
    //Mes
    let mes = document.createElement("DIV");
    mes.className = "mes";
    calendario.appendChild(mes);
    //Tabla
    let tabla_mes = document.createElement("TABLE");
    tabla_mes.className = "tabla_mes";
    mes.appendChild(tabla_mes);
    //Título
    let titulo = document.createElement("CAPTION");
    titulo.className = "titulo";
    titulo.innerText = mes_text[m];
    tabla_mes.appendChild(titulo);
    //Cabecera
    let cabecera = document.createElement("THEAD");
    tabla_mes.appendChild(cabecera);
    let fila = document.createElement("TR");
    cabecera.appendChild(fila);
    for (d = 0; d < 7; d++) {
      let dia = document.createElement("TH");
      dia.innerText = dia_text[d];
      fila.appendChild(dia);
    }
    //Cuerpo
    let numWeek = 1
    let cuerpo = document.createElement("TBODY");
    tabla_mes.appendChild(cuerpo);
    for (f = 0; f < 6; f++) {
      let fila = document.createElement("TR");
      fila.className = "week" + numWeek
      cuerpo.appendChild(fila);
      for (d = 0; d < 7; d++) {
        let dia = document.createElement("TD");
        dia.innerText = "";
        fila.appendChild(dia);
          
      }
      numWeek++      
    } 
    
  }
}

numerar();

function numerar() {
  for (i = 1; i < 366; i++) {
    let fecha = fechaPorDia(2017, i);
    let mes = fecha.getMonth();
    let select_tabla = document.getElementsByClassName('tabla_mes')[mes];
    let dia = fecha.getDate()
    let dia_semana = fecha.getDay();
    if (dia == 1) {var sem = 0;}
    if(dia == goalDay && mes+1 == goalMonth){
    select_tabla.children[2].children[sem].children[dia_semana].parentElement.className = "goalCalendar"  
    select_tabla.children[2].children[sem].children[dia_semana].innerText = dia;
    } else {
    select_tabla.children[2].children[sem].children[dia_semana].innerText = dia;
    }
    if(dia-1 == dateActualWeight[2] && mes+1 == dateActualWeight[1]){
      select_tabla.children[2].children[sem].children[dia_semana].className = "objetivo"
    
    }
    
    if (dia_semana == 6) { sem = sem + 1; }
  }
}

function fechaPorDia(año, dia) {
  var date = new Date(año, 0);
  return new Date(date.setDate(dia));
}

</script>